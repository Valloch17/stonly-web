<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="/assets/favicon-32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="/assets/favicon-192.png" sizes="192x192" type="image/png">
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png" sizes="180x180">
    <title>Stonly Guide Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <!-- Heading font: Space Grotesk -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/shared.css">
    <style>
        /* Page-level overrides only */
        :root {
            --bg: #fae9f0;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
    </style>
</head>

<body class="min-h-screen">
    <main class="max-w-5xl mx-auto px-4 py-8 space-y-6">
        <div class="flex items-start justify-between gap-3">
            <div>
                <h1 class="text-2xl font-semibold flex items-center gap-2">
                    <img src="/assets/Stonly_logotype_master_digital.svg" alt="Stonly" class="h-12 w-auto logo-light">
                    <img src="/assets/Stonly_logotype_full_white_digital.svg" alt="Stonly"
                        class="h-12 w-auto logo-dark">
                    <span class="title-text">Guide Builder</span>
                </h1>
                <p class="text-sm text-slate-500 dark:text-slate-400">Create guides and steps from YAML with the Stonly
                    API.
                </p>
            </div>
            <div class="flex items-center gap-3 pt-1">
                <a href="/"
                    class="inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-slate-300 bg-card text-sm font-medium shadow hover:bg-slate-50 transition">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-4 h-4">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M4 6h4l2 2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z" />
                    </svg>
                    KB Builder
                </a>
                <button id="themeToggle" class="theme-toggle" type="button" aria-label="Toggle theme">
                    <span id="themeIcon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M6.76 4.84 5.34 3.42 3.92 4.84l1.42 1.42L6.76 4.84zM1 13h3v-2H1v2zm10 10h2v-3h-2v3zm7.66-2.58 1.42-1.42-1.42-1.42-1.42 1.42 1.42 1.42zM20 13h3v-2h-3v2zM11 1h2v3h-2V1zM4.84 17.24 3.42 18.66l1.42 1.42 1.42-1.42-1.42-1.42zM17.24 4.84l1.42-1.42 1.42 1.42-1.42 1.42-1.42-1.42zM12 6a6 6 0 1 0 0 12 6 6 0 0 0 0-12z" />
                        </svg>
                    </span>
                    <span id="themeLabel">Dark</span>
                </button>
            </div>
        </div>

        <section class="bg-card border rounded-xl shadow-sm p-5 space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <!-- Admin token -->
                <div>
                    <label for="token" class="block text-sm font-medium">Admin token <span
                            class="text-red-600">*</span></label>
                    <input id="token" type="password" class="mt-1 w-full border rounded-lg p-2 text-sm"
                        placeholder="The token can be found on Confluence" />
                </div>

                <!-- Stonly API Base URL -->
                <div>
                    <label for="base" class="block text-sm font-medium">Stonly API Base URL</label>
                    <input id="base" type="text" placeholder="https://public.stonly.com/api/v3"
                        value="https://public.stonly.com/api/v3" class="mt-1 w-full border rounded-lg p-2 text-sm" />
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div>
                    <label class="block text-sm font-medium">Stonly username <span class="text-red-600">*</span></label>
                    <input id="user" type="text" required aria-required="true"
                        class="mt-1 w-full border rounded-lg p-2 text-sm" placeholder="email@company.com"
                        autocomplete="off" />
                </div>
                <div>
                    <label class="block text-sm font-medium">Stonly token <span class="text-red-600">*</span></label>
                    <input id="password" type="password" required aria-required="true"
                        class="mt-1 w-full border rounded-lg p-2 text-sm" placeholder="Your Stonly integration token"
                        autocomplete="off" />
                </div>
            </div>
            <div class="flex flex-wrap items-center gap-x-6 gap-y-2">
                <label class="inline-flex items-center gap-2">
                    <input id="publishAfter" type="checkbox" class="h-4 w-4" checked>
                    <span class="text-sm font-medium">Publish after build</span>
                </label>

                <label class="inline-flex items-center gap-2">
                    <input id="dryRun" type="checkbox" class="h-4 w-4">
                    <span class="text-sm font-medium">Dry-run</span>
                </label>
            </div>


            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div>
                    <label class="block text-sm font-medium">Team ID <span class="text-red-600">*</span></label>
                    <input id="teamId" type="number" class="mt-1 w-full border rounded-lg p-2 text-sm"
                        placeholder="e.g. 39539" />
                </div>
                <div>
                    <label class="block text-sm font-medium">Folder ID <span class="text-red-600">*</span></label>
                    <input id="folderId" type="number" class="mt-1 w-full border rounded-lg p-2 text-sm"
                        placeholder="e.g. 456234" />
                </div>
            </div>
        </section>

        <section class="bg-card border rounded-xl shadow-sm p-5 space-y-4">
            <header>
                <h2 class="text-lg font-semibold">Guide defaults</h2>
                <p class="text-sm text-slate-500">These values pre-fill the payload. YAML values override them when
                    provided.</p>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-12 gap-3 items-end">
                <!-- Content title (wide) -->
                <div class="md:col-span-7">
                    <label class="block text-sm font-medium">Content title</label>
                    <input id="contentTitle" type="text"
                        class="mt-1 w-full border border-neutral rounded-lg p-2 text-sm"
                        placeholder="Onboarding walkthrough" />
                </div>

                <!-- Content type (keep your exact options) -->
                <div class="md:col-span-3">
                    <label class="block text-sm font-medium">Content type</label>
                    <select id="contentType" class="mt-1 w-full border border-neutral rounded-lg p-2 text-sm bg-card">
                        <option value="GUIDE">GUIDE</option>
                        <option value="ARTICLE">ARTICLE</option>
                        <option value="GUIDED_TOUR">GUIDED_TOUR</option>
                    </select>
                </div>

                <!-- Language (narrow, right side) -->
                <div class="md:col-span-2 md:justify-self-end">
                    <label class="block text-sm font-medium">Language</label>
                    <input id="language" type="text"
                        class="mt-1 w-full md:w-24 text-center border border-neutral rounded-lg p-2 text-sm"
                        placeholder="en" value="en" />
                </div>
            </div>

        </section>

        <section class="bg-card border rounded-xl shadow-sm p-5 space-y-4">
            <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                <div>
                    <h2 class="text-lg font-semibold">Guide YAML <span class="text-red-600">*</span></h2>
                    <p class="text-sm text-slate-500">Describe the guide structure using nested steps and choices.</p>
                </div>
                <div class="flex items-center gap-2">
                    <!-- Examples dropdown -->
                    <div class="relative inline-block">
                        <button id="btnExample"
                            class="px-3 py-2 rounded-md border border-neutral bg-card text-sm font-medium" type="button"
                            aria-haspopup="true" aria-expanded="false">
                            Examples ▾
                        </button>

                        <div id="examplesMenu"
                            class="absolute left-0 mt-1 w-72 rounded-md border bg-card shadow-lg hidden z-40">
                            <button class="w-full text-left px-3 py-2 text-sm hover:bg-neutral/10"
                                data-example="article">ARTICLE — single step</button>
                            <button class="w-full text-left px-3 py-2 text-sm hover:bg-neutral/10"
                                data-example="guide_media">GUIDE — branches + media</button>
                            <button class="w-full text-left px-3 py-2 text-sm hover:bg-neutral/10"
                                data-example="tour">GUIDED_TOUR — linear</button>
                            <button class="w-full text-left px-3 py-2 text-sm hover:bg-neutral/10"
                                data-example="troubleshoot">GUIDE — rich HTML & code</button>
                        </div>
                    </div>


                    <button id="parseYamlBtn" class="px-3 py-2 rounded-md border bg-card text-sm font-medium"
                        type="button">
                        Parse YAML
                    </button>
                    <button id="createGuideBtn"
                        class="px-3 py-2 rounded-md bg-blue-600 text-white text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed"
                        type="button">Create guide</button>
                </div>
            </header>

            <div>
                <textarea id="guideYaml" class="mt-1 w-full border rounded-lg p-3 text-sm h-64 font-mono" placeholder="guide:
  contentTitle: Product Walkthrough
  language: en-US
  firstStep:
    title: Welcome aboard
    content: &quot;&lt;p&gt;Thanks for joining us!&lt;/p&gt;&quot;
    choices:
      - label: Explore setup
        step:
          title: Configure basics
          content: &quot;&lt;p&gt;Let's configure your workspace.&lt;/p&gt;&quot;
      - label: Watch tour
        step:
          title: Product tour
          content: &quot;&lt;p&gt;Watch a short overview.&lt;/p&gt;&quot;"></textarea>
                <small id="yamlError" class="text-red-600 text-xs"></small>
            </div>
            <!-- <div class="border border-dashed border-neutral rounded-lg p-4 bg-slate-50 dark:bg-slate-900/40">
                <h3 class="text-sm font-semibold mb-2">YAML format</h3>
                <ul class="list-disc pl-5 space-y-1 text-sm text-slate-600">
                    <li>Top-level <code class="font-mono">guide</code> object must include <code
                            class="font-mono">contentTitle</code>,
                        <code class="font-mono">language</code>, and <code class="font-mono">firstStep</code>.
                    </li>
                    <li>Each step defines a <code class="font-mono">title</code>, <code class="font-mono">content</code>
                        (HTML allowed), and optional <code class="font-mono">choices</code> array.</li>
                    <li>Choices accept <code class="font-mono">label</code>, optional <code
                            class="font-mono">position</code>, and a nested <code class="font-mono">step</code>.</li>
                    <li>Optional step fields: <code class="font-mono">media</code> (up to 3 URLs), <code
                            class="font-mono">position</code>, <code class="font-mono">language</code>.</li>
                </ul>
            </div> -->
        </section>

        <section class="bg-card border rounded-xl shadow-sm p-5 space-y-4">
            <header class="flex items-center justify-between gap-3">
                <h2 class="text-lg font-semibold">Preview</h2>
                <span id="previewStatus" class="inline-flex items-center gap-2 text-sm text-slate-500">Waiting for
                    YAML.</span>
            </header>
            <div id="previewTree" class="space-y-3 text-sm"></div>
        </section>

        <section class="bg-card border border-neutral rounded-xl shadow-sm p-5 space-y-4">
            <header class="flex items-center justify-between gap-3">
                <div>
                    <h2 class="text-lg font-semibold">Execution plan</h2>
                    <p class="text-sm text-slate-500">Review the payloads before hitting the API.</p>
                </div>
                <div class="flex items-center gap-2">
                    <button id="togglePlan" class="px-3 py-2 rounded-md border bg-card text-sm font-medium"
                        type="button">
                        Show
                    </button>
                    <button id="copyOut" class="px-3 py-2 rounded-md border bg-card text-sm font-medium" type="button">
                        Copy plan
                    </button>
                </div>
            </header>

            <div id="planContainer" class="hidden">
                <pre id="out" class="border rounded-lg p-4 text-xs overflow-auto max-h-80 whitespace-pre-wrap"></pre>
            </div>

        </section>

        <div class="card">
            <div class="card-header">
                <div class="title">Logs</div>
                <div class="flex items-center gap-2">
                    <button id="btnFetchLogs" type="button"
                        class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-md border border-neutral bg-card text-sm font-medium hover:brightness-105 transition">
                        Fetch
                    </button>
                    <button id="btnClearLogs" type="button"
                        class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-md border border-neutral bg-card text-sm font-medium hover:brightness-105 transition">
                        Clear
                    </button>
                </div>
            </div>
            <div id="logsContent" class="card-content hidden">
                <textarea id="logBox" class="text-xs"
                    style="width:100%;height:220px;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;"></textarea>

            </div>
        </div>

    </main>

    <div class="contact-badge">
        <span>Contact:
            <a href="mailto:valentin.bourrelier@stonly.com">valentin.bourrelier@stonly.com</a>
        </span>
        <span class="sep">|</span>
        <a class="gh" href="https://github.com/Valloch17/stonly-web" target="_blank" rel="noopener noreferrer"
            aria-label="Open GitHub repository">
            <svg viewBox="0 0 24 24" aria-hidden="true" fill="currentColor">
                <path
                    d="M12 .5a11.5 11.5 0 0 0-3.64 22.42c.58.1.79-.25.79-.56v-2c-3.2.7-3.87-1.54-3.87-1.54-.53-1.34-1.28-1.7-1.28-1.7-1.05-.72.08-.7.08-.7 1.16.08 1.77 1.2 1.77 1.2 1.03 1.77 2.7 1.26 3.36.96.1-.75.4-1.26.73-1.55-2.55-.29-5.23-1.28-5.23-5.7 0-1.26.45-2.3 1.2-3.12-.12-.29-.52-1.46.11-3.04 0 0 .98-.31 3.2 1.19a11.1 11.1 0 0 1 5.82 0c2.22-1.5 3.2-1.19 3.2-1.19.63 1.58.23 2.75.11 3.04.75.82 1.2 1.86 1.2 3.12 0 4.43-2.68 5.4-5.24 5.69.41.35.77 1.04.77 2.11v3.13c0 .31.21.67.8.56A11.5 11.5 0 0 0 12 .5z" />
            </svg>
            <span>GitHub</span>
        </a>
    </div>
    <!--  -->

    <!-- 
     -->
    <!-- 
     -->

    <!--  -->
    <script src="/js/shared.js?v=1"></script>
    <script src="/js/guide.js?v=1"></script>
</body>

</html>
